import{R as N}from"./RButton-CTE1q-iz.js";import{_ as g}from"./RInput-B1ogfpup.js";import{s as F,b as c,e as p,o as u,u as j,v as z,f as V,p as R,g as A,c as b,a as w,d as s,t as T,i as n,m as q,q as v,w as d,x as E,k as L,n as S,j as U,l as _}from"./index-CEviYTYm.js";const P={__name:"RCombobox",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const r=F(x,"modelValue");return(k,i)=>{const y=c("v-combobox");return u(),p(y,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=e=>r.value=e),variant:"underlined","persistent-placeholder":"","return-object":""},null,8,["modelValue"])}}},G={class:"container"},H={class:"main-title"},Q={__name:"ItemForm",setup(x){const r=q(),k=L(),i=j(),y=z(),e=V({category:null}),t=V(null),m=V(null);R(t,()=>{if(!t.value)return m.value=null;const a=new FileReader;a.onload=l=>{m.value=l.target.result},a.readAsDataURL(t.value)});const $=A(()=>![e.value.name,e.value.price,e.value.info,e.value.category,t.value].every(l=>l)),M=async a=>{try{const l=new FormData;l.append("image",t.value,t.value.name),_.post(`/api/items/${a}/images`,l,{headers:{"Content-Type":"multipart/form-data"}})}catch(l){console.error(l.message)}},B=async()=>{try{const a=await _[e.value.item_id?"patch":"post"](e.value.item_id?`api/items/${e.value.item_id}`:"api/items",{name:e.value.name,info:e.value.info,price:e.value.price,category_id:e.value.category.category_id});M(a.data.item_id),k.push(`/items/${e.value.category.name_en}`)}catch(a){console.error(a.message),alert("Ошибка!")}},D=async()=>{try{const a=await _.get(`api/items/${r.params.id}`);e.value={...a.data,price:Number(a.data.price)}}catch(a){console.error(a.message),alert("Ошибка!")}try{const a=await _.get(`api/items/${r.params.id}/images`,{responseType:"blob",withCredentials:!1});t.value=a.data}catch(a){console.error(a.message)}};return R(()=>r.params.id,()=>r.params.id?D():e.value={},{immediate:!0}),(a,l)=>{const h=c("v-img"),f=c("v-col"),C=c("v-row"),I=c("v-file-input");return u(),b("section",null,[w("div",G,[w("h1",H,T(n(r).params.id?e.value.title:"Добавление товара"),1),w("form",null,[n(i).isMobile?(u(),p(C,{key:0},{default:d(()=>[s(f,null,{default:d(()=>[m.value?(u(),p(h,{key:0,style:{"max-height":"400px"},src:m.value},null,8,["src"])):v("",!0)]),_:1})]),_:1})):v("",!0),s(C,null,{default:d(()=>[s(f,null,{default:d(()=>[s(g,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.name=o),label:"Название"},null,8,["modelValue"]),s(g,{modelValue:e.value.price,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.price=o),label:"Цена"},null,8,["modelValue"]),s(P,{modelValue:e.value.category,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.category=o),label:"Категория","item-title":"name_ru",items:n(y).items},null,8,["modelValue","items"]),s(g,{modelValue:e.value.info,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.info=o),label:"Дополнительная информация"},null,8,["modelValue"]),n(i).isMobile&&!m.value?(u(),b("div",{key:0,style:S({color:n(U).error})},"Загрузите фото товара",4)):v("",!0),s(I,{modelValue:t.value,"onUpdate:modelValue":l[4]||(l[4]=o=>t.value=o),label:"Фото товара",class:"mb-8","prepend-icon":"mdi-camera","hide-input":"",variant:"underlined"},null,8,["modelValue"])]),_:1}),n(i).isMobile?v("",!0):(u(),p(f,{key:0},{default:d(()=>[m.value?(u(),p(h,{key:0,style:{"max-height":"600px"},src:m.value},null,8,["src"])):(u(),b("div",{key:1,style:S({color:n(U).error})},"Загрузите фото товара",4))]),_:1}))]),_:1})]),s(N,{text:"Сохранить",class:E(n(i).isMobile?"w-100":""),disabled:$.value,onClick:B},null,8,["class","disabled"])])])}}};export{Q as default};
